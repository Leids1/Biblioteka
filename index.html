<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Драгоценные Игры</title>
  <link href="https://fonts.googleapis.com/css2?family=Rubik+Mono+One&family=Rubik:wght@400;500&display=swap" rel="stylesheet">
  <link rel="icon" href="https://iili.io/KClTnwl.png" sizes="128x128">
  <style>
    /* ---------------- basic animations & fonts ---------------- */
    @keyframes bounce { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes popupShow { from { transform: translate(-50%, -50%) scale(0.95); opacity: 0; } to { transform: translate(-50%, -50%) scale(1); opacity: 1; } }
    @keyframes popupHide { from { transform: translate(-50%, -50%) scale(1); opacity: 1; } to { transform: translate(-50%, -50%) scale(0.95); opacity: 0; } }
    @keyframes popup-border-move {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }

    html,body { height:100%; margin:0; }
    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      font-family: 'Rubik', Arial, sans-serif;
      animation: fadeIn 1s ease;
      background-image: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url(https://iili.io/KBVdvQp.webp);
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      transition: background-image 0.6s ease-in-out, opacity 0.25s ease;
      color: white;
      font-size: 19px;
    }

    button {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
      position: relative;
      overflow: hidden;
      z-index: 1;
      will-change: transform, box-shadow;
      transform: translateZ(0);
    }

    /* ---------------- header / overlay ---------------- */
    .overlay {
      position: sticky;
      top: 0;
      z-index: 50;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      background: rgba(0,0,0,0.55);
      padding: 18px 12px;
      backdrop-filter: blur(4px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.5);
      border-radius: 0 0 14px 14px;
    }
    .overlay h1 { margin:0; font-size: 26px; color: #fff; }
    .filter-bar { display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap; }
    .filter-bar button {
      background: linear-gradient(90deg, #18181c 0%, #2a2340 100%);
      border: 1px solid rgba(255,255,255,0.08);
      color: #fff;
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
      transition:
        background 0.18s cubic-bezier(.4,1,.7,1),
        box-shadow .18s cubic-bezier(.4,1,.7,1),
        color .18s cubic-bezier(.4,1,.7,1),
        transform 0.18s cubic-bezier(.4,1,.7,1);
    }
    .filter-bar button:hover {
      background: linear-gradient(90deg, #2a2340 0%, #7c4dff 100%);
      /* убрана transform и box-shadow */
      color: #e6dfff;
    }

    /* ---------------- grid / cards ---------------- */
    .images-container {
      max-width: 1200px;
      margin: 28px auto;
      padding: 0 24px 80px 24px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 22px;
    }
    @media (max-width:1100px) { .images-container { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width:680px) { .images-container { grid-template-columns: 1fr; } }

    .image-with-text {
      background: linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.45));
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 6px 18px rgba(0,0,0,0.5);
      transition: transform .25s ease, box-shadow .25s ease;
      cursor: pointer;
      display:flex;
      flex-direction:column;
      min-height: 320px;
    }
    .image-with-text:hover { transform: translateY(-6px) scale(1.02); box-shadow: 0 0 7px #a259ff, 0 6px 18px rgba(0,0,0,0.5); }
    .image-with-text img { width:100%; height:200px; object-fit:cover; display:block; border-bottom: 1px solid rgba(255,255,255,0.03); }
    .card-body { padding: 12px 14px 16px 14px; display:flex; flex-direction:column; gap:8px; flex:1; }
    .card-title { font-size:22px; margin:0; color:#fff; line-height:1.1; }
    .platforms { display:flex; gap:8px; font-size:21px; align-items:center; }
    .description {
      color: #eee;
      font-size:17px;
      line-height:1.4;
      margin: 0;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .game-rating { font-size: 18px; }

    /* ---------------- background controls ---------------- */
    .background-controls {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 60;
      display:flex;
      align-items:center;
      gap:8px;
      background: rgba(0,0,0,0.55);
      padding:10px;
      border-radius:12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.5);
    }
    .background-controls img { width:32px; height:32px; display:block; }
    .background-controls button { background: transparent; border: none; color: #fff; font-size: 16px; cursor: pointer; }
    .background-controls button:hover { transform:scale(1.08); }

    /* ---------------- popups ---------------- */
    .overlay-background {
      position: fixed; inset:0;
      background: rgba(0,0,0,0.7);
      z-index: 90;
      display:none;
      opacity: 0;
      transition: opacity .32s ease;
    }
    .overlay-background.show { display:block; opacity:1; }

    .popup {
      position: fixed;
      left: 50%; top: 50%;
      transform: translate(-50%,-50%) scale(.98);
      z-index: 100;
      background: rgba(8,8,8,0.95);
      border-radius: 14px;
      max-width: 800px;
      width: 98vw;
      max-height: 84vh;
      padding: 18px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.5);
      display:none;
      opacity:0;
      z-index: 100;
      box-sizing: border-box;
      /* убираем inset/padding для рамки */
      /* новая анимированная рамка */
      --popup-glow: 0 0 0 1.5px #7c4dff, 0 0 9px 1.5px #a259ff, 0 0 18px 1.5px #6a4fb3;
      box-shadow: var(--popup-glow), 0 4.5px 13.5px rgba(0,0,0,0.5);
      animation: popup-border-glow 4s linear infinite;
      /* убираем overflow, чтобы не появлялись скроллы */
      overflow: auto;
    }
    @keyframes popup-border-glow {
      0% {
        --popup-glow: 0 0 0 1.5px #7c4dff, 0 0 9px 1.5px #a259ff, 0 0 18px 1.5px #6a4fb3;
      }
      33% {
        --popup-glow: 0 0 0 1.5px #a259ff, 0 0 9px 1.5px #6a4fb3, 0 0 18px 1.5px #7c4dff;
      }
      66% {
        --popup-glow: 0 0 0 1.5px #6a4fb3, 0 0 9px 1.5px #7c4dff, 0 0 18px 1.5px #a259ff;
      }
      100% {
        --popup-glow: 0 0 0 1.5px #7c4dff, 0 0 9px 1.5px #a259ff, 0 0 18px 1.5px #6a4fb3;
      }
    }
    /* убираем псевдоэлемент .popup::before */
    .popup::before {
      display: none !important;
    }
    .popup.show { display:block; animation: popupShow .32s ease both; }
    .popup.hide { animation: popupHide .28s ease both; }
    .popup img { width:100%; max-height: 360px; object-fit:cover; border-radius:10px; margin-bottom:12px; }
    .popup h2 { font-size:22px; margin:6px 0; color:#ffd; }
    .popup p { color:#ddd; font-size:18px; line-height:1.45; text-align:left; }
    .popup .links { margin-top:12px; display:flex; gap:12px; flex-direction:column; }
    .popup a.button {
      display:block; text-align:center;
      padding:12px; border-radius:10px;
      text-decoration:none; color:white; font-weight:600;
      background: linear-gradient(45deg,#ff6a00,#ee0979);
      box-shadow: 0 8px 26px rgba(238,100,120,0.12);
    }
    .popup .close-btn {
      margin-top:12px;
      background:#ff6347;
      border:none;
      padding:10px 14px;
      border-radius:8px;
      color:white;
      cursor:pointer;
      font-weight:600;
    }
    .sr-only { position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden; }

    /* Контент попапа — комментарии + игра */
    .popup-content {
      display: flex;
      gap: 20px;               /* отступ между блоками */
      width: 100%;
      justify-content: center; /* центрируем содержимое */
      align-items: stretch; /* изменено с flex-start на stretch */
      min-height: 420px; /* можно увеличить при необходимости */
      position: relative; /* добавлено для абсолютного позиционирования */
    }

    /* Комментарии слева */
    .curator-comments {
      flex: 0 0 250px;         /* фиксированная ширина */
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      padding: 12px;
      color: #ccc;
      font-size: 14px;
      line-height: 1.4;
      overflow-y: auto;
      max-height: none; /* убираем ограничение */
      height: 100%;     /* растягиваем на всю высоту */
      align-self: stretch; /* растягиваем на всю высоту родителя */
    }

    /* Блок игры в центре */
    .game-details {
      flex: 1;                 /* занимает оставшееся место */
      max-width: 900px;        /* но не слишком широкий */
      display: flex;
      flex-direction: column;
      height: 100%;
      position: relative; /* для абсолютной кнопки */
    }
    .game-details .close-btn {
      position: absolute;
      left: -300px; /* кнопка заходит на блок комментария */
      bottom: -10px; /* отступ от нижней части попапа */
      z-index: 10;
      margin: 0;
      align-self: unset;
    }

    /* Адаптив для телефонов */
    @media (max-width: 900px) {
      .popup-content {
        flex-direction: column;
        align-items: center;
      }
      .curator-comments {
        width: 100%;
        max-width: 500px;
      }
    }

    /* Только игровой попап — сдвигаем левее */
    #gamePopup {
      transform: translate(-60%, -50%) scale(.98) !important;
    }

    /* Отключаем взаимодействие с карточками при открытых попапах age/download */
    .no-interaction,
    .no-interaction .image-with-text {
      pointer-events: none !important;
      user-select: none !important;
      opacity: 0.7;
      filter: blur(1px);
      /* display не трогаем! */
    }

    #downloadInfoPopup,
    #ageRestrictionPopup {
      max-width: 700px;
    }

    @media (max-width: 600px) {
      body { font-size: 18px; }
      .overlay h1 { font-size: 22px; }
      .card-title { font-size: 18px; }
      .description { font-size: 16px; }
      .game-rating { font-size: 16px; }
      .platforms { font-size: 18px; }
      .popup, .image-with-text, .card-body, .curator-comments {
        padding: 18px 10px !important;
      }
      .popup p, .curator-comments { font-size: 16px; }
    }

    #animated-bg-canvas {
      position: fixed;
      left: 0; top: 0;
      width: 100vw;
      height: 100vh;
      z-index: -1;
      pointer-events: none;
      opacity: 0.45;
      background: transparent;
    }

  </style>
    
</head>
<body>
  <!-- header -->
  <div class="overlay" role="banner">
    <h1>Библиотека:</h1>
    <div class="filter-bar" role="tablist" aria-label="Фильтр по платформам">
      <button type="button" onclick="filterGames('all')">Все</button>
      <button type="button" onclick="filterGames('pc')">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-laptop-minimal-icon lucide-laptop-minimal" style="vertical-align:middle;"><rect width="18" height="12" x="3" y="4" rx="2" ry="2"/><line x1="2" x2="22" y1="20" y2="20"/></svg>
        PC
      </button>
      <button type="button" onclick="filterGames('mobile')">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-smartphone-icon lucide-smartphone" style="vertical-align:middle;"><rect width="14" height="20" x="5" y="2" rx="2" ry="2"/><path d="M12 18h.01"/></svg>
        Mobile
      </button>
      <button type="button" onclick="filterGames('vr')">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rectangle-goggles-icon lucide-rectangle-goggles" style="vertical-align:middle;"><path d="M20 6a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-4a2 2 0 0 1-1.6-.8l-1.6-2.13a1 1 0 0 0-1.6 0L9.6 17.2A2 2 0 0 1 8 18H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z"/></svg>
        VR
      </button>
      <button type="button" id="togglePaidBtn" onclick="togglePaidGames()" title="Скрыть платные игры" aria-pressed="false" style="padding:8px 12px; display:flex; align-items:center; gap:6px;">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-dollar-sign-icon lucide-circle-dollar-sign" style="vertical-align:middle;"><circle cx="12" cy="12" r="10"/><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"/><path d="M12 18V6"/></svg>
        <span id="togglePaidBtnText" style="font-size:16px; display:inline-flex; align-items:center;">
          Скрывать платный контент
          <span id="togglePaidBtnIcon" style="display:inline-flex; margin-left:6px;">
            <!-- по умолчанию перечёркнутый глаз -->
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye-off-icon lucide-eye-off"><path d="M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49"/><path d="M14.084 14.158a3 3 0 0 1-4.242-4.242"/><path d="M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143"/><path d="m2 2 20 20"/></svg>
          </span>?
        </span>
      </button>
    </div>
  </div>

  <!-- grid -->
  <div class="images-container" id="imagesContainer">

    <!-- Kemomimi -->
    <div class="image-with-text"
         data-platforms="pc"
         data-title="Kemomimi Treasure Hunters!"
         data-image="image/KBVdNyJ.jpg"
         data-description="Жизнь брата и сестры резко меняется, когда найденный матерью гриб становится причиной неожиданной болезни. Путешествие к аптекарю открывает новые испытания: жадный врач требует непомерную сумму за спасение любимой женщины. Брат и сестра объединяют усилия, рискуя жизнью, чтобы найти сокровище и купить драгоценное лекарство."
         data-page="https://www.dropbox.com/scl/fi/cwdovgrxr3rqkr45ovdh5/Kemomimi_Treasure_Hunters.7z?dl=0"
         data-download="https://www.dropbox.com/scl/fi/cwdovgrxr3rqkr45ovdh5/Kemomimi_Treasure_Hunters.7z?dl=0"
         data-comment="Редкая кайфовая игра, lonaRPG на минималках с неко-кошечками и неко-котиками. Официального сайта уже давно не существует."
         onclick="openGameCard(this)">
      <img src="image/KBVdNyJ.jpg" alt="Kemomimi Treasure Hunters!">
      <div class="card-body">
        <h3 class="card-title">Kemomimi Treasure Hunters!</h3>
        <div class="platforms" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-laptop-minimal-icon lucide-laptop-minimal"><rect width="18" height="12" x="3" y="4" rx="2" ry="2"/><line x1="2" x2="22" y1="20" y2="20"/></svg>
        </div>
        <p class="description">Жизнь брата и сестры резко меняется, когда найденный матерью гриб становится причиной неожиданной болезни...</p>
      </div>
    </div>

    <!-- My Dystopian Robot Girlfriend -->
    <div class="image-with-text"
         data-platforms="pc mobile"
         data-title="My Dystopian Robot Girlfriend"
         data-image="image/KBVdW41.jpg"
         data-description="В антиутопическом будущем 2026 году рынок секс-ботов процветал. Их численность быстро превзошла всю автомобильную промышленность, и золотой век мира казался ближе, чем когда-либо прежде. Увы, месяц спустя международный скандал между США и Китаем вылился во всемирный запрет секс-ботов. Жизнь никогда не была бы прежней."
         data-page="https://incontinentcell.itch.io/factorial-omega"
         data-download="https://incontinentcell.itch.io/factorial-omega"
         data-comment="Симулятор Дани в 2030 году, гибкий кастом + поддержка модов. Прямой ссылки для загрузки нет."
         onclick="openGameCard(this)">
      <img src="image/KBVdW41.jpg" alt="My Dystopian Robot Girlfriend">
      <div class="card-body">
        <h3 class="card-title">My Dystopian Robot Girlfriend</h3>
        <div class="platforms" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-laptop-minimal-icon lucide-laptop-minimal"><rect width="18" height="12" x="3" y="4" rx="2" ry="2"/><line x1="2" x2="22" y1="20" y2="20"/></svg>
          <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-smartphone-icon lucide-smartphone"><rect width="14" height="20" x="5" y="2" rx="2" ry="2"/><path d="M12 18h.01"/></svg>
        </div>
        <p class="description">В антиутопическом будущем 2026 году рынок секс-ботов процветал. Их численность быстро превзошла всю...</p>
      </div>
    </div>

    <!-- LonaRPG -->
    <div class="image-with-text"
         data-platforms="pc"
         data-title="LonaRPG"
         data-image="image/KBVdkjR.jpg"
         data-description="Помогите Лоне в этом жестоком и неумолимом мире и сбегите с острова Ноер! Управляйте ее судьбой и решите ее судьбу!"
         data-page="https://eccma417.fanbox.cc"
         data-download="https://www.dropbox.com/scl/fi/c8wnbof996ld6rb2zg37r/LonaRPG.B.0.9.9.0.5.zip?rlkey=j2oa67d9purq5hwyntxbdd009&st=5hkxsi1m&dl=0"
         data-comment="Классика и хардкор, продуманная до мелочей. Легенда, которую каждый должен знать. Игра была куплена лично мной, и сейчас её архив лежит в загрузке"
         onclick="openGameCard(this)">
      <img src="image/KBVdkjR.jpg" alt="LonaRPG">
      <div class="card-body">
        <h3 class="card-title">LonaRPG</h3>
        <div class="platforms" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-laptop-minimal-icon lucide-laptop-minimal"><rect width="18" height="12" x="3" y="4" rx="2" ry="2"/><line x1="2" x2="22" y1="20" y2="20"/></svg>
        </div>
        <p class="description">Помогите Лоне в этом жестоком и неумолимом мире и сбегите с острова Ноер...</p>
      </div>
    </div>

    <!-- KoboldKare -->
    <div class="image-with-text"
         data-platforms="pc paid"
         data-title="KoboldKare"
         data-image="image/KBvR4Fj.jpg"
         data-description="KoboldKare - это симулятор фермерства, но вместо производства продуктов вы производите голых кобольдов! Это FPS-игра, в которой есть прыжки, серфинг, тримпинг, а также секс.."
         data-page="https://store.steampowered.com/app/1102930/KoboldKare"
         data-download="https://koboldkare.com/download"
         data-comment="Если вы хотели трахнуть своего друга, купите лицензию в стиме и ни в чём себе не отказывайте."
         onclick="openGameCard(this)">
      <img src="image/KBvR4Fj.jpg" alt="KoboldKare">
      <div class="card-body">
        <h3 class="card-title">KoboldKare</h3>
        <div class="platforms" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-laptop-minimal-icon lucide-laptop-minimal"><rect width="18" height="12" x="3" y="4" rx="2" ry="2"/><line x1="2" x2="22" y1="20" y2="20"/></svg>
          <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-dollar-sign-icon lucide-circle-dollar-sign"><circle cx="12" cy="12" r="10"/><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"/><path d="M12 18V6"/></svg>
        </div>
        <p class="description">KoboldKare - это симулятор фермерства, но вместо производства продуктов вы производите...</p>
      </div>
    </div>

    <div class="image-with-text"
         data-platforms="pc vr"
         data-title="Koikatsu!"
         data-image="image/KCofkiJ.jpg"
         data-description="эроге-симулятор старшей школы. Где игрок (мужчина) отправляется в школу, где учатся одни девочки... В школе вы можете общаться и находить общий язык с девушками, которых вы добавили в школу, улучшать клуб или заниматься сексом с девушками."
         data-page="https://vk.com/1koikatsu"
         data-download="https://drive.google.com/file/d/16SkvKzQqLK0-5q_y1oRzz5298iJ4dGn5/view"
         data-comment="Анимешники забудут что такое реальность, нереальный кастом + тонна модов, можно соиться с любым героем из аниме благодаря модам, 800-летняя Сенко? Без проблем. Рафталия из героя щита? Да её до тебя тут уже все по кругу пустили, хоть мику хатсуне используй, я не удивлюсь если тут и пудж из доты есть. В качестве сайта игры выбрана группа ру сообщества в ВК, там есть моды и сейвы 100%."
         onclick="openGameCard(this)">
      <img src="image/KCofkiJ.jpg" alt="Koikatsu!">
      <div class="card-body">
        <h3 class="card-title">Koikatsu!</h3>
        <div class="platforms" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-laptop-minimal-icon lucide-laptop-minimal"><rect width="18" height="12" x="3" y="4" rx="2" ry="2"/><line x1="2" x2="22" y1="20" y2="20"/></svg>
          <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rectangle-goggles-icon lucide-rectangle-gогgles"><path d="M20 6a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-4a2 2 0 0 1-1.6-.8l-1.6-2.13a1 1 0 0 0-1.6 0L9.6 17.2A2 2 0 0 1 8 18H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z"/></svg>
        </div>
        <p class="description">эроге-симулятор старшей школы. Поддерживает моды и Виртуальную Реальность</p>
      </div>
    </div>

    <!-- REC -->
    <div class="image-with-text"
         data-platforms="pc mobile"
         data-title="Rec"
         data-image="image/KnDgvR9.png"
         data-description="Вы бедный студент университета. Однажды вы найдете волшебную камеру, которая решит все ваши финансовые проблемы! Единственная проблема в том, что вам нужно снять что-то непристойное."
         data-page="https://moondev64.itch.io/rec"
         data-download="1"
         data-comment="1"
         onclick="openGameCard(this)">
      <img src="image/KnDgvR9.png" alt="Rec">
      <div class="card-body">
        <h3 class="card-title">🔴 REC</h3>
        <div class="platforms" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-laptop-minimal-icon lucide-laptop-minimal"><rect width="18" height="12" x="3" y="4" rx="2" ry="2"/><line x1="2" x2="22" y1="20" y2="20"/></svg>
          <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-smartphone-icon lucide-smartphone"><rect width="14" height="20" x="5" y="2" rx="2" ry="2"/><path d="M12 18h.01"/></svg>
        </div>
        <p class="description">Вы бедный студент университета. Однажды вы найдете волшебную камеру, которая решит все ваши финансовые проблемы! Единственная проблема в том, что вам нужно снять что-то непристойное.</p>
      </div>
    </div>

    <div class="image-with-text"
         data-platforms="pc paid"
         data-title="Anomalous Coffee Machine"
         data-image="image/KCmVnLl.webp"
         data-description="Аномальная кофемашина это уникальная игра в стиле интерактивного симулятора визуального романа, в которой вы встречаетесь с загадочной девушкой, которая по неизвестным причинам просит вас использовать и исследовать ее загадочный и, казалось бы, аномальный автомат по продаже кофе (например, SCP-294)!"
         data-page="https://store.steampowered.com/app/3173560/Anomalous_Coffee_Machine"
         data-download="https://koboldkare.com/download"
         data-comment="Н"
         onclick="openGameCard(this)">
      <img src="image/KCmVnLl.webp" alt="Anomalous Coffee Machine">
      <div class="card-body">
        <h3 class="card-title">Anomalous Coffee Machine</h3>
        <div class="platforms" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-laptop-minimal-icon lucide-laptop-minimal"><rect width="18" height="12" x="3" y="4" rx="2" ry="2"/><line x1="2" x2="22" y1="20" y2="20"/></svg>
          <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-dollar-sign-icon lucide-circle-dollar-sign"><circle cx="12" cy="12" r="10"/><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"/><path d="M12 18V6"/></svg>
        </div>
        <p class="description">Аномальная кофемашина это уникальная игра в стиле интерактивного симулятора визуального романа, в которой вы встречаетесь с загадочной девушкой, которая по неизвестным причинам просит вас использовать и исследовать ее загадочный и, казалось бы, аномальный автомат по продаже кофе (например, SCP-294)!</p>
      </div>
    </div>

    <div class="image-with-text"
         data-platforms="pc paid"
         data-title="Anomalous Coffee Machine 2"
         data-image="image/KCm4s5J.jpg"
         data-description="Аномальная кофемашина 2 это странный интерактивный визуальный роман и вымышленный симулятор, в котором вы стоите напротив загадочной девушки и скромного автомата по продаже кофе, способного производить все, что вы печатаете, каким бы невозможным это ни казалось. Она не говорит вам, кто она, почему она там, и в чем дело с кофемашиной. Все, что она просит, это ввести любое слово и нажать кнопку."
         data-page="https://store.steampowered.com/app/3173560/Anomalous_Coffee_Machine"
         data-download="https://koboldkare.com/download"
         data-comment="Н"
         onclick="openGameCard(this)">
      <img src="image/KCm4s5J.jpg" alt="Anomalous Coffee Machine">
      <div class="card-body">
        <h3 class="card-title">Anomalous Coffee Machine 2</h3>
        <div class="platforms" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-laptop-minimal-icon lucide-laptop-minimal"><rect width="18" height="12" x="3" y="4" rx="2" ry="2"/><line x1="2" x2="22" y1="20" y2="20"/></svg>
          <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-dollar-sign-icon lucide-circle-dollar-sign"><circle cx="12" cy="12" r="10"/><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"/><path d="M12 18V6"/></svg>
        </div>
        <p class="description">Аномальная кофемашина 2 это странный интерактивный визуальный роман и вымышленный симулятор, в котором вы стоите напротив загадочной девушки и скромного автомата по продаже кофе, способного производить все, что вы печатаете, каким бы невозможным это ни казалось. Она не говорит вам, кто она, почему она там, и в чем дело с кофемашиной. Все, что она просит, это ввести любое слово и нажать кнопку.</p>
      </div>
    </div>
  </div><!-- images-container -->

  <!-- background controls -->
  <div class="background-controls" aria-hidden="true">
    <img src="https://iili.io/KBWAzvf.png" alt="bg icon">
    <button onclick="changeBackground(1)">1</button>
    <button onclick="changeBackground(2)">2</button>
    <button onclick="changeBackground(3)">3</button>
    <button onclick="changeBackground(4)">4</button>
  </div>

  <!-- overlay background -->
  <div class="overlay-background" id="overlayBg" aria-hidden="true"></div>

<!-- game popup -->
<div class="popup" id="gamePopup" role="dialog" aria-modal="true" aria-labelledby="gameTitle">
  <div class="popup-content">
    
    <!-- Левая колонка: комментарии -->
    <div class="curator-comments" id="curatorComments">
      <h3>Комментарий куратора</h3>
      <p>ТЕст коментария»</p>
    </div>

    <!-- Центральная колонка: игра -->
    <div class="game-details">
      <img id="gameImage" src="" alt="game image">
      <h2 id="gameTitle"></h2>
      <p id="gameDescription"></p>
      <div class="links">
        <a id="pageLink" class="button" href="#" target="_blank" rel="noopener">Страница игры</a>
        <a id="downloadLink" class="button" href="#" target="_blank" rel="noopener">Загрузить игру</a>
      </div>
      <button class="close-btn" onclick="closePopup('gamePopup')">Закрыть</button>
    </div>

  </div>
</div>


  <!-- download info popup -->
  <div class="popup" id="downloadInfoPopup" role="dialog" aria-modal="true">
    <h2>Подсказка</h2>
    <p>Для скачивания игры нажмите на карточку.</p>
    <button class="close-btn" onclick="closePopup('downloadInfoPopup')">Закрыть</button>
  </div>

  <!-- age restriction -->
  <div class="popup" id="ageRestrictionPopup" role="dialog" aria-modal="true">
    <h2>18+</h2>
    <p>Все игры на сайте предназначены для лиц старше 18 лет.</p>
    <button class="close-btn" onclick="closeAgePopup()">Я согласен / Закрыть</button>
  </div>

  <script>
    /* ---------------- data + helpers ---------------- */
    function changeBackground(index) {
      const backgrounds = [
        'linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url(https://iili.io/KBVdvQp.webp)',
        'linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url(https://iili.io/KBXHzAJ.jpg)',
        'linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url(https://iili.io/KBWDQAQ.jpg)',
        'linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url(https://iili.io/KBWQttt.jpg)'
      ];
      if (index < 1 || index > backgrounds.length) return;
      document.body.style.opacity = '0';
      setTimeout(() => {
        document.body.style.backgroundImage = backgrounds[index-1];
        document.body.style.opacity = '1';
      }, 180);
    }

    // Флаг для скрытия платных игр
    let hidePaidGames = false;

    function togglePaidGames() {
      hidePaidGames = !hidePaidGames;
      const btn = document.getElementById('togglePaidBtn');
      const btnText = document.getElementById('togglePaidBtnText');
      const btnIcon = document.getElementById('togglePaidBtnIcon');
      btn.setAttribute('aria-pressed', hidePaidGames ? 'true' : 'false');
      btn.title = hidePaidGames ? 'Показать платные игры' : 'Скрыть платные игры';
      if (hidePaidGames) {
        btn.style.background = 'rgba(255,255,255,0.12)';
        btnText.childNodes[0].textContent = 'Показывать платный контент';
        btnIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye-icon lucide-eye"><path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"/><circle cx="12" cy="12" r="3"/></svg>`;
      } else {
        btn.style.background = '';
        btnText.childNodes[0].textContent = 'Скрывать платный контент';
        btnIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye-off-icon lucide-eye-off"><path d="M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49"/><path d="M14.084 14.158a3 3 0 0 1-4.242-4.242"/><path d="M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143"/><path d="m2 2 20 20"/></svg>`;
      }
      updatePaidGamesVisibility();
    }

    function updatePaidGamesVisibility() {
      const cards = document.querySelectorAll('.image-with-text');
      cards.forEach(card => {
        const isPaid = (card.dataset.platforms || '').split(' ').includes('paid');
        if (hidePaidGames && isPaid) {
          card.style.display = 'none';
        } else {
          // Не трогаем фильтрацию по платформам, только возвращаем если не скрыто фильтром
          if (card.style.display === 'none' && !hidePaidGames) {
            // Проверяем, не скрыта ли карточка фильтром платформ
            const currentPlatform = window.currentPlatformFilter || 'all';
            const platforms = card.dataset.platforms || '';
            if (currentPlatform === 'all' || platforms.includes(currentPlatform)) {
              card.style.display = '';
            }
          }
          if (!hidePaidGames && card.style.display === 'none') {
            // не трогаем, если скрыто фильтром платформ
          }
        }
      });
    }

    /* ---------------- filter by platform ---------------- */
    window.currentPlatformFilter = 'all';
    function filterGames(platform) {
      window.currentPlatformFilter = platform;
      const cards = document.querySelectorAll('.image-with-text');
      cards.forEach(card => {
        const platforms = card.dataset.platforms || '';
        const isPaid = platforms.split(' ').includes('paid');
        if ((platform === 'all' || platforms.includes(platform)) && !(hidePaidGames && isPaid)) {
          card.style.display = '';
        } else {
          card.style.display = 'none';
        }
      });
    }

    /* ---------------- popup handling ---------------- */
    function openPopup(id) {
      const popup = document.getElementById(id);
      const overlay = document.getElementById('overlayBg');
      if (!popup) return;
      popup.style.display = 'block';
      popup.classList.remove('hide');
      requestAnimationFrame(() => {
        popup.classList.add('show');
        overlay.classList.add('show');
      });
    }
    function closePopup(id) {
      const popup = document.getElementById(id);
      const overlay = document.getElementById('overlayBg');
      if (!popup) return;
      if (popup.classList.contains('hide')) return;
      popup.classList.remove('show');
      popup.classList.add('hide');
      const onAnimEnd = (e) => {
        if (e.target !== popup) return;
        popup.removeEventListener('animationend', onAnimEnd);
        popup.classList.remove('hide');
        popup.style.display = 'none';
        const anyOpen = Array.from(document.querySelectorAll('.popup')).some(p => p.classList.contains('show'));
        if (!anyOpen) overlay.classList.remove('show');
        // Если закрыли downloadInfoPopup, возвращаем интерактивность карточкам
        if (id === 'downloadInfoPopup') setCardsInteractive(true);
      };
      popup.addEventListener('animationend', onAnimEnd);
    }

    // Вспомогательная функция для управления интерактивностью карточек
    function setCardsInteractive(enabled) {
      const container = document.getElementById('imagesContainer');
      if (!container) return;
      if (enabled) {
        container.classList.remove('no-interaction');
        // Принудительный reflow для корректного восстановления хитбоксов
        void container.offsetHeight;
      } else {
        container.classList.add('no-interaction');
      }
    }

    /* ---------------- age popup ---------------- */
    function closeAgePopup() {
      closePopup('ageRestrictionPopup');
      setCardsInteractive(false); // пока открыт downloadInfoPopup
      setTimeout(() => { 
        openPopup('downloadInfoPopup'); 
      }, 420);
    }

    /* ---------------- open game card ---------------- */
    function openGameCard(el) {
      const title = el.dataset.title;
      const image = el.dataset.image;
      const description = el.dataset.description;
      const pageLink = el.dataset.page;
      const downloadLink = el.dataset.download;
      const comment = el.dataset.comment || "Комментарий отсутствует.";

      document.getElementById('gameTitle').textContent = title;
      document.getElementById('gameImage').src = image;
      document.getElementById('gameImage').alt = title;
      document.getElementById('gameDescription').textContent = description;

      // Показываем/скрываем кнопки в зависимости от игры
      const pageBtn = document.getElementById('pageLink');
      const downloadBtn = document.getElementById('downloadLink');
      if (title === "Kemomimi Treasure Hunters!") {
        pageBtn.style.display = "none";
        downloadBtn.style.display = "";
      } else if (title === "My Dystopian Robot Girlfriend") {
        pageBtn.style.display = "";
        downloadBtn.style.display = "none";
      } else if (title === "KoboldKare") {
        pageBtn.style.display = "";
        downloadBtn.style.display = "none";
      } else if (title === "snapshot") {
        pageBtn.style.display = "";
        downloadBtn.style.display = "none";
      } else {
        pageBtn.style.display = "";
        downloadBtn.style.display = "";
      }
      pageBtn.href = pageLink || '#';
      downloadBtn.href = downloadLink || '#';

      document.getElementById('curatorComments').innerHTML =
        '<h3>Комментарий куратора</h3><p>' + comment + '</p>';

      openPopup('gamePopup');
    }

    /* ---------------- init ---------------- */
    window.addEventListener('load', function() {
      document.getElementById('overlayBg').classList.remove('show');
      setCardsInteractive(false);
      setTimeout(() => { openPopup('ageRestrictionPopup'); }, 300);
    });
    document.getElementById('overlayBg').addEventListener('click', (e) => { e.stopPropagation(); });

    // Клик по overlay закрывает только игровые попапы
    document.getElementById('overlayBg').addEventListener('click', function() {
      const gamePopup = document.getElementById('gamePopup');
      // Проверяем открыт ли игровой попап
      if (gamePopup && gamePopup.classList.contains('show')) {
        closePopup('gamePopup');
      }
      // Не закрываем ageRestrictionPopup и downloadInfoPopup
    });

    // Анимированные частицы на фоне
    (function() {
      const canvas = document.getElementById('animated-bg-canvas');
      const ctx = canvas.getContext('2d');
      let w = window.innerWidth, h = window.innerHeight;
      let particles = [];
      const PARTICLE_COUNT = Math.max(32, Math.floor(w * h / 18000));
      function resize() {
        w = window.innerWidth;
        h = window.innerHeight;
        canvas.width = w;
        canvas.height = h;
      }
      window.addEventListener('resize', resize);
      resize();

      function randomColor() {
        // Фиолетовый + синий + бирюзовый
        const colors = ['#a259ff', '#1de9b6', '#3f51b5', '#7c4dff'];
        return colors[Math.floor(Math.random() * colors.length)];
      }

      function createParticle() {
        return {
          x: Math.random() * w,
          y: Math.random() * h,
          r: 18 + Math.random() * 22,
          dx: (Math.random() - 0.5) * 0.5,
          dy: (Math.random() - 0.5) * 0.5,
          alpha: 0.18 + Math.random() * 0.22,
          color: randomColor()
        };
      }

      particles = Array.from({length: PARTICLE_COUNT}, createParticle);

      function animate() {
        ctx.clearRect(0, 0, w, h);
        for (let p of particles) {
          ctx.save();
          ctx.globalAlpha = p.alpha;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r, 0, 2 * Math.PI);
          ctx.fillStyle = p.color;
          ctx.shadowColor = p.color;
          ctx.shadowBlur = 24;
          ctx.fill();
          ctx.restore();

          p.x += p.dx;
          p.y += p.dy;
          // wrap around
          if (p.x < -p.r) p.x = w + p.r;
          if (p.x > w + p.r) p.x = -p.r;
          if (p.y < -p.r) p.y = h + p.r;
          if (p.y > h + p.r) p.y = -p.r;
        }
        requestAnimationFrame(animate);
      }
      animate();
    })();
  </script>
</body>
</html>

